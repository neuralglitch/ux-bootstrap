{# templates/components/extra/comparison-table.html.twig #}
{# Comparison Table Component for feature comparisons #}

{% set o = this.options() %}

{# Capture custom content slot #}
{% set slot_content %}{% block content %}{% endblock %}{% endset %}
{% set has_custom_content = slot_content is not empty and slot_content|trim != '' %}

<section class="comparison-table {{ o.classes }}" {{ this.renderHtmlAttributes(o.attrs) | raw }}>
  <div class="{{ o.container }}">
    {# Title and Description #}
    {% if o.title or o.description %}
      <div class="text-center mb-4">
        {% if o.title %}
          <h2 class="mb-3">{{ o.title }}</h2>
        {% endif %}
        {% if o.description %}
          <p class="lead text-muted">{{ o.description }}</p>
        {% endif %}
      </div>
    {% endif %}

    {# Custom content or default table #}
    {% if has_custom_content %}
      {{ slot_content|raw }}
    {% else %}
      {# Cards variant (mobile-friendly) #}
      {% if o.variant == 'cards' %}
        <div class="row g-4">
          {% for column in o.columns %}
            <div class="col-12 col-md-6 col-lg-4">
              <div class="card h-100 {% if loop.index0 == o.highlightColumn %}border-primary border-2 shadow{% endif %}">
                <div class="card-header text-center {% if column.variant %}bg-{{ column.variant }} text-white{% endif %}">
                  <h4 class="mb-0">{{ column.title ?? 'Plan ' ~ loop.index }}</h4>
                  {% if column.badge is defined and column.badge %}
                    <span class="badge bg-{{ column.badge_variant ?? 'warning' }} mt-2">{{ column.badge }}</span>
                  {% endif %}
                </div>
                <div class="card-body">
                  {% if column.price is defined and column.price %}
                    <div class="text-center mb-4">
                      <h3 class="display-5">{{ column.price }}</h3>
                      {% if column.period is defined and column.period %}
                        <p class="text-muted">{{ column.period }}</p>
                      {% endif %}
                    </div>
                  {% endif %}
                  <ul class="list-unstyled">
                    {% for feature in o.features %}
                      <li class="mb-2">
                        <strong>{{ feature.feature }}:</strong> 
                        {% set value = feature.values[loop.parent.index0] ?? o.emptyText %}
                        {% if value is same as(true) or value == 'true' %}
                          <span class="text-success fs-5"><twig:ux:icon name="bi:check-circle-fill" /></span>
                        {% elseif value is same as(false) or value == 'false' %}
                          <span class="text-danger fs-5"><twig:ux:icon name="bi:x-circle-fill" /></span>
                        {% elseif value is not null %}
                          <span>{{ value }}</span>
                        {% else %}
                          <span>{{ o.emptyText }}</span>
                        {% endif %}
                      </li>
                    {% endfor %}
                  </ul>
                  {% if column.cta_label and column.cta_href %}
                    <a href="{{ column.cta_href }}" class="btn btn-{{ column.cta_variant ?? 'primary' }} w-100">{{ column.cta_label }}</a>
                  {% endif %}
                </div>
              </div>
            </div>
          {% endfor %}
        </div>

      {# Horizontal variant (features as columns, products as rows) #}
      {% elseif o.variant == 'horizontal' %}
        <div class="{% if o.responsive %}table-responsive{% endif %}">
          <table class="{{ o.tableClasses }}">
            <thead {% if o.sticky %}class="sticky-top bg-body"{% endif %}>
              <tr>
                <th scope="col">Plan</th>
                {% for feature in o.features %}
                  <th scope="col">{{ feature.feature }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% for column in o.columns %}
                <tr {% if loop.index0 == o.highlightColumn %}class="table-primary"{% endif %}>
                  <th scope="row">
                    <div>
                      {{ column.title ?? 'Plan ' ~ loop.index }}
                      {% if column.badge is defined and column.badge %}
                        <span class="badge bg-{{ column.badge_variant ?? 'warning' }} ms-2">{{ column.badge }}</span>
                      {% endif %}
                    </div>
                    {% if column.price is defined and column.price %}
                      <div class="small text-muted">{{ column.price }}{% if column.period is defined and column.period %}/{{ column.period }}{% endif %}</div>
                    {% endif %}
                  </th>
                  {% for feature in o.features %}
                    <td>
                      {% set value = feature.values[loop.parent.index0] ?? o.emptyText %}
                      {% if value is same as(true) or value == 'true' %}
                        <span class="text-success fs-5"><twig:ux:icon name="bi:check-circle-fill" /></span>
                      {% elseif value is same as(false) or value == 'false' %}
                        <span class="text-danger fs-5"><twig:ux:icon name="bi:x-circle-fill" /></span>
                      {% elseif value is not null %}
                        <span>{{ value }}</span>
                      {% else %}
                        <span>{{ o.emptyText }}</span>
                      {% endif %}
                    </td>
                  {% endfor %}
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

      {# Default, bordered, and striped variants (vertical table) #}
      {% else %}
        <div class="{% if o.responsive %}table-responsive{% endif %}">
          <table class="{{ o.tableClasses }}">
            <thead {% if o.sticky %}class="sticky-top bg-body"{% endif %}>
              <tr>
                <th scope="col">Feature</th>
                {% for column in o.columns %}
                  <th scope="col" {% if loop.index0 == o.highlightColumn %}class="table-primary position-relative"{% else %}class="position-relative"{% endif %} style="padding-top: {% if column.badge is defined and column.badge %}2.5rem{% else %}1rem{% endif %}; vertical-align: bottom;">
                    {% if column.badge is defined and column.badge %}
                      <span class="badge bg-{{ column.badge_variant ?? 'warning' }}">{{ column.badge }}</span>
                    {% endif %}
                    <div class="d-flex flex-column align-items-center justify-content-end">
                      <span>{{ column.title ?? ('Plan ' ~ loop.index) }}</span>
                      {% if column.price is defined and column.price %}
                        <div class="h4 mb-0 mt-2">{{ column.price }}</div>
                        {% if column.period is defined and column.period %}
                          <small class="text-muted">per {{ column.period }}</small>
                        {% endif %}
                      {% endif %}
                    </div>
                  </th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% for feature in o.features %}
                <tr>
                  <th scope="row">
                    <span>{{ feature.feature }}</span>
                    {% if feature.description %}
                      <br><small class="text-muted fw-normal">{{ feature.description }}</small>
                    {% endif %}
                  </th>
                  {% for value in feature.values %}
                    <td {% if loop.index0 == o.highlightColumn %}class="table-primary"{% endif %}>
                      {% if value is same as(true) or value == 'true' %}
                        <span class="text-success fs-5"><twig:ux:icon name="bi:check-circle-fill" /></span>
                      {% elseif value is same as(false) or value == 'false' %}
                        <span class="text-danger fs-5"><twig:ux:icon name="bi:x-circle-fill" /></span>
                      {% elseif value is not null %}
                        <span>{{ value }}</span>
                      {% else %}
                        <span>{{ o.emptyText }}</span>
                      {% endif %}
                    </td>
                  {% endfor %}
                </tr>
              {% endfor %}

              {# CTA row at bottom #}
              {% if o.columns|filter(c => c.cta_label ?? false)|length > 0 %}
                <tr>
                  <td></td>
                  {% for column in o.columns %}
                    <td {% if loop.index0 == o.highlightColumn %}class="table-primary"{% endif %}>
                      {% if column.cta_label and column.cta_href %}
                        <a href="{{ column.cta_href }}" class="btn btn-{{ column.cta_variant ?? 'primary' }} w-100">{{ column.cta_label }}</a>
                      {% endif %}
                    </td>
                  {% endfor %}
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      {% endif %}
    {% endif %}
  </div>
</section>
