{% apply spaceless -%}

  {% set o = this.options() %}

  {% dump(o) %}

  {# Auto-detect parent accordion ID from context if not explicitly set #}
  {% set parent_id = o.parentId ?? (accordion_parent_id is defined ? accordion_parent_id : null) %}
  {% set always_open = accordion_always_open is defined ? accordion_always_open : false %}

  {# Slot for accordion body content #}
  {% set slot_content %}{% block content %}{% endblock %}{% endset %}

  <div class="{{ o.itemClasses }}" {{ this.renderHtmlAttributes(o.attrs) | raw }}>
    <h2 class="accordion-header">
      <button 
        class="{{ o.buttonClasses }}" 
        type="button" 
        data-bs-toggle="collapse" 
        data-bs-target="#{{ o.targetId }}" 
        aria-expanded="{{ o.show ? 'true' : 'false' }}" 
        aria-controls="{{ o.targetId }}">
        {{ o.header|raw }}
      </button>
    </h2>
    <div 
      id="{{ o.targetId }}" 
      class="{{ o.collapseClasses }}"
      {% if parent_id and not always_open %}data-bs-parent="#{{ parent_id }}"{% endif %}
      aria-labelledby="{{ o.targetId }}-heading">
      <div class="accordion-body">
        {{ slot_content|raw }}
      </div>
    </div>
  </div>

{%- endapply %}

